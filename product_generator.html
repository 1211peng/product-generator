<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“è³‡è¨Šèˆ‡æ–‡æ¡ˆç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #333;
        }
        .container {
            max-width: 960px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #fff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        input[type="text"],
        input[type="number"],
        input[type="url"],
        textarea {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            resize: vertical;
        }
        input:focus,
        textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4b5563;
        }
        button {
            background-color: #6366f1;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
            width: 100%;
        }
        button:hover {
            background-color: #4f46e5;
            transform: translateY(-1px);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
        }
        .secondary-button {
            background-color: #f0f4f8;
            color: #4b5563;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .secondary-button:hover {
            background-color: #e2e8f0;
        }
        .output-section {
            background-color: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-top: 2rem;
            border: 1px dashed #e5e7eb;
        }
        .output-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        .output-item {
            margin-bottom: 1.5rem;
        }
        .output-item h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        .output-item pre {
            background-color: #e0e7ff;
            padding: 1rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #1e3a8a;
        }
        .price-display {
            font-size: 2rem;
            font-weight: 700;
            color: #10b981;
            text-align: center;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #ecfdf5;
            border-radius: 0.75rem;
            border: 2px solid #34d399;
        }
        .price-display span {
            font-size: 1.2rem;
            color: #065f46;
        }
        .history-list {
            margin-top: 2rem;
            border-top: 1px solid #e5e7eb;
            padding-top: 1.5rem;
        }
        .history-item {
            background-color: #ffffff;
            border: 1px solid #e0e7ff;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        .history-item-info {
            flex-grow: 1;
        }
        .history-item-info h5 {
            font-weight: 700;
            color: #374151;
            margin-bottom: 0.25rem;
        }
        .history-item-info p {
            font-size: 0.9rem;
            color: #6b7280;
        }
        .history-item-actions {
            display: flex;
            gap: 0.5rem;
        }
        .history-item-actions button {
            width: auto;
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
            border-radius: 0.5rem;
            box-shadow: none;
        }
        .history-item-actions .view-button {
            background-color: #4f46e5;
        }
        .history-item-actions .view-button:hover {
            background-color: #4338ca;
        }
        .history-item-actions .delete-button {
            background-color: #ef4444;
        }
        .history-item-actions .delete-button:hover {
            background-color: #dc2626;
        }
        .search-input {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">å•†å“è³‡è¨Šèˆ‡æ–‡æ¡ˆç”Ÿæˆå™¨</h2>

        <div class="input-section mb-8">
            <h3 class="text-2xl font-bold mb-4 text-gray-700">å•†å“è³‡è¨Šè²¼ä¸Šå€</h3>
            <label for="fullProductInfoInput">è«‹å°‡æ‰€æœ‰å•†å“è³‡è¨Šè²¼åˆ°é€™è£¡ (åŒ…å«å“åã€é€£çµã€æ¬¾å¼ã€å‚™è¨»ã€æˆæœ¬ç­‰):</label>
            <textarea id="fullProductInfoInput" rows="10" placeholder="ä¾‹å¦‚ï¼š
è·¨å¢ƒæ±½è½¦é‡‘å±ä¸€é”®å¯åŠ¨æ‘‡æ†çƒè½¦è½½ä¸€é”®å¯åŠ¨è£…é¥°è´´æ±½è½¦æŒ‰é’®é”®ä¿æŠ¤ç›–
https://detail.1688.com/offer/947903075253.html?offerId=947903075253
é¡è‰²ï¼šç´…ã€é»‘ã€è—
ä¸€çµ„2å…¥
æˆæœ¬10/é‹15/é›†30"></textarea>

            <button onclick="generateProductInfo()">ç”Ÿæˆå•†å“è³‡è¨Šèˆ‡å”®åƒ¹</button>
        </div>

        <div class="output-section" id="outputSection">
            <h3 class="text-2xl font-bold mb-4 text-gray-700">ç”Ÿæˆçµæœ</h3>

            <div class="output-item">
                <h4>å„ªåŒ–å¾Œå“å (ç¹é«”)</h4>
                <pre id="optimizedProductName"></pre>
            </div>

            <div class="output-item">
                <h4>IG Reel æ–‡æ¡ˆ</h4>
                <pre id="igReelContent"></pre>
            </div>

            <div class="output-item">
                <h4>Threads æ–‡æ¡ˆ</h4>
                <pre id="threadsContent"></pre>
            </div>

            <div class="output-item">
                <h4>å®˜ç¶²æ–‡æ¡ˆ</h4>
                <pre id="officialWebsiteContent"></pre>
            </div>

            <div class="output-item">
                <h4>IG POV æ–‡æ¡ˆ</h4>
                <pre id="igPovContent"></pre>
            </div>

            <div class="price-display">
                å»ºè­°å”®åƒ¹: <span id="suggestedPrice"></span>
            </div>
        </div>

        <div class="history-list">
            <h3 class="text-2xl font-bold mb-4 text-gray-700">æ­·å²ç´€éŒ„</h3>
            <input type="text" id="searchHistory" class="search-input" placeholder="æœå°‹æ­·å²ç´€éŒ„...">
            <button onclick="exportToCsv()" class="secondary-button mb-4">åŒ¯å‡ºç‚º CSV (Excel)</button>
            <div id="productHistoryList">
                <!-- æ­·å²å•†å“åˆ—è¡¨å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                <p class="text-gray-500 text-center" id="noHistoryMessage">ç›®å‰æ²’æœ‰æ­·å²ç´€éŒ„ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // DOM å…ƒç´ å¼•ç”¨
        const fullProductInfoInput = document.getElementById('fullProductInfoInput');

        const optimizedProductNameOutput = document.getElementById('optimizedProductName');
        const igReelContentOutput = document.getElementById('igReelContent');
        const threadsContentOutput = document.getElementById('threadsContent');
        const officialWebsiteContentOutput = document.getElementById('officialWebsiteContent');
        const igPovContentOutput = document.getElementById('igPovContent');
        const suggestedPriceOutput = document.getElementById('suggestedPrice');

        const productHistoryListDiv = document.getElementById('productHistoryList');
        const searchHistoryInput = document.getElementById('searchHistory');
        const noHistoryMessage = document.getElementById('noHistoryMessage');

        const localStorageKey = 'productGeneratorHistoryV2'; // localStorage çš„éµå€¼ï¼Œå„²å­˜æ‰€æœ‰æ­·å²ç´€éŒ„

        // --- è¼”åŠ©å‡½æ•¸ï¼šç°¡é«”è½‰ç¹é«” (ç°¡åŒ–ç‰ˆï¼Œé‡å°ç‰¹å®šè©å½™) ---
        function convertToTraditional(text) {
            let convertedText = text;
            // å¯¶å¯å¤¢ç›¸é—œ
            convertedText = convertedText.replace(/å®å¯æ¢¦/g, 'å¯¶å¯å¤¢');
            convertedText = convertedText.replace(/Gengar/g, 'è€¿é¬¼');
            convertedText = convertedText.replace(/è€€è¥¿/g, 'è€€è¥¿');
            convertedText = convertedText.replace(/è¿ä½“ç¡è¡£/g, 'é€£é«”ç¡è¡£');
            convertedText = convertedText.replace(/æƒ…ä¾£/g, 'æƒ…ä¾¶');
            convertedText = convertedText.replace(/äº²å­/g, 'è¦ªå­');
            convertedText = convertedText.replace(/å®¶å±…æœ/g, 'å®¶å±…æœ');
            convertedText = convertedText.replace(/ç”²è´ºå¿è›™/g, 'ç”²è³€å¿è›™');
            convertedText = convertedText.replace(/è·¯å¡åˆ©æ¬§/g, 'è·¯å¡åˆ©æ­');
            convertedText = convertedText.replace(/è¶…æ¢¦/g, 'è¶…å¤¢');
            convertedText = convertedText.replace(/å‘†ç«é³„/g, 'å‘†ç«é±·');
            convertedText = convertedText.replace(/ä¼Šå¸ƒ/g, 'ä¼Šå¸ƒ');

            // æ±½è»Šç›¸é—œ
            convertedText = convertedText.replace(/æ±½è½¦/g, 'æ±½è»Š');
            convertedText = convertedText.replace(/é‡‘å±/g, 'é‡‘å±¬');
            convertedText = convertedText.replace(/ä¸€é”®å¯åŠ¨/g, 'ä¸€éµå•Ÿå‹•');
            convertedText = convertedText.replace(/æ‘‡æ†çƒ/g, 'æ–æ¡¿çƒ');
            convertedText = convertedText.replace(/è½¦è½½/g, 'è»Šè¼‰');
            convertedText = convertedText.replace(/è£…é¥°è´´/g, 'è£é£¾è²¼');
            convertedText = convertedText.replace(/æŒ‰é’®é”®/g, 'æŒ‰éˆ•éµ');
            convertedText = convertedText.replace(/ä¿æŠ¤ç›–/g, 'ä¿è­·è“‹');

            // å…¶ä»–å¸¸è¦‹ç°¡é«”å­—
            convertedText = convertedText.replace(/è·¨å¢ƒ/g, 'è·¨å¢ƒ');
            convertedText = convertedText.replace(/é¢œè‰²/g, 'é¡è‰²');
            convertedText = convertedText.replace(/çº¢è‰²/g, 'ç´…è‰²');
            convertedText = convertedText.replace(/é»‘è‰²/g, 'é»‘è‰²');
            convertedText = convertedText.replace(/è“è‰²/g, 'è—è‰²');
            convertedText = convertedText.replace(/ç»„/g, 'çµ„');
            convertedText = convertedText.replace(/å…¥/g, 'å…¥');
            convertedText = convertedText.replace(/å†…æ–‡/g, 'å…§æ–‡');
            convertedText = convertedText.replace(/å¤‡æ³¨/g, 'å‚™è¨»');
            convertedText = convertedText.replace(/æˆæœ¬/g, 'æˆæœ¬');
            convertedText = convertedText.replace(/è¿/g, 'é‹');
            convertedText = convertedText.replace(/é›†/g, 'é›†');
            convertedText = convertedText.replace(/é“¾æ¥/g, 'é€£çµ');


            return convertedText;
        }

        // --- å„²å­˜æ‰€æœ‰æ­·å²è³‡æ–™åˆ° localStorage ---
        function saveProductHistory(history) {
            try {
                localStorage.setItem(localStorageKey, JSON.stringify(history));
                console.log('å•†å“æ­·å²è³‡æ–™å·²å„²å­˜åˆ° localStorageã€‚');
            } catch (e) {
                console.error('å„²å­˜åˆ° localStorage å¤±æ•—:', e);
                alert('å„²å­˜æ­·å²ç´€éŒ„å¤±æ•—ï¼Œå¯èƒ½æ˜¯ç€è¦½å™¨å„²å­˜ç©ºé–“ä¸è¶³æˆ–éš±ç§è¨­å®šé™åˆ¶ã€‚');
            }
        }

        // --- å¾ localStorage è¼‰å…¥æ‰€æœ‰æ­·å²è³‡æ–™ ---
        function loadProductHistory() {
            try {
                const savedData = localStorage.getItem(localStorageKey);
                return savedData ? JSON.parse(savedData) : [];
            } catch (e) {
                console.error('å¾ localStorage è¼‰å…¥å¤±æ•—:', e);
                alert('è¼‰å…¥æ­·å²ç´€éŒ„å¤±æ•—ï¼Œå¯èƒ½æ˜¯å„²å­˜çš„è³‡æ–™æå£ã€‚');
                return [];
            }
        }

        // --- é¡¯ç¤ºæ­·å²ç´€éŒ„åˆ—è¡¨ ---
        function displayProductHistory(filterText = '') {
            const history = loadProductHistory();
            productHistoryListDiv.innerHTML = ''; // æ¸…ç©ºç¾æœ‰åˆ—è¡¨

            if (history.length === 0) {
                noHistoryMessage.style.display = 'block';
                return;
            } else {
                noHistoryMessage.style.display = 'none';
            }

            const filteredHistory = history.filter(item => {
                const searchLower = filterText.toLowerCase();
                return item.optimizedProductName.toLowerCase().includes(searchLower) ||
                       item.originalProductName.toLowerCase().includes(searchLower) ||
                       item.igReelContent.toLowerCase().includes(searchLower) ||
                       item.threadsContent.toLowerCase().includes(searchLower) ||
                       item.officialWebsiteContent.toLowerCase().includes(searchLower) ||
                       item.igPovContent.toLowerCase().includes(searchLower);
            });

            if (filteredHistory.length === 0 && filterText !== '') {
                productHistoryListDiv.innerHTML = '<p class="text-gray-500 text-center">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ­·å²ç´€éŒ„ã€‚</p>';
                return;
            }

            // å€’åºé¡¯ç¤ºï¼Œæœ€æ–°åœ¨æœ€ä¸Šé¢
            filteredHistory.slice().reverse().forEach((item, index) => {
                const historyItemDiv = document.createElement('div');
                historyItemDiv.className = 'history-item';
                historyItemDiv.innerHTML = `
                    <div class="history-item-info">
                        <h5>${item.optimizedProductName}</h5>
                        <p>å»ºè­°å”®åƒ¹: $${item.suggestedPrice}</p>
                        <p>åŸå§‹å“å: ${item.originalProductName.substring(0, 50)}...</p>
                        <p>ç”Ÿæˆæ™‚é–“: ${item.timestamp}</p>
                    </div>
                    <div class="history-item-actions">
                        <button class="view-button" onclick="loadProductToForm(${item.id})">æŸ¥çœ‹/ç·¨è¼¯</button>
                        <button class="delete-button" onclick="deleteProductFromHistory(${item.id})">åˆªé™¤</button>
                    </div>
                `;
                productHistoryListDiv.appendChild(historyItemDiv);
            });
        }

        // --- å°‡æ­·å²å•†å“è³‡æ–™è¼‰å…¥åˆ°è¡¨å–®å’Œè¼¸å‡ºå€ ---
        function loadProductToForm(id) {
            const history = loadProductHistory();
            const product = history.find(item => item.id === id);

            if (product) {
                // é‡å»ºå–®ä¸€è¼¸å…¥æ¬„ä½çš„å…§å®¹
                let fullInfo = product.originalProductName + '\n';
                if (product.productUrl) fullInfo += product.productUrl + '\n';
                if (product.styles) fullInfo += `é¡è‰²/æ¬¾å¼ï¼š${product.styles}\n`;
                if (product.sizes) fullInfo += `å°ºå¯¸ï¼š${product.sizes}\n`;
                if (product.internalNotes) fullInfo += `å‚™è¨»ï¼š${product.internalNotes}\n`;
                fullInfo += `æˆæœ¬${product.cost}/é‹${product.shipping}/é›†${product.collectionFee}\n`;
                fullProductInfoInput.value = fullInfo.trim();

                // åŒæ™‚æ›´æ–°è¼¸å‡ºå€åŸŸ
                optimizedProductNameOutput.textContent = product.optimizedProductName;
                igReelContentOutput.textContent = product.igReelContent;
                threadsContentOutput.textContent = product.threadsContent;
                officialWebsiteContentOutput.textContent = product.officialWebsiteContent;
                igPovContentOutput.textContent = product.igPovContent;
                suggestedPriceOutput.textContent = `$${product.suggestedPrice}`;
            }
        }

        // --- å¾æ­·å²ç´€éŒ„ä¸­åˆªé™¤å•†å“ ---
        function deleteProductFromHistory(id) {
            let history = loadProductHistory();
            const originalLength = history.length;
            history = history.filter(item => item.id !== id);

            if (history.length < originalLength) {
                saveProductHistory(history);
                displayProductHistory(searchHistoryInput.value); // é‡æ–°é¡¯ç¤ºåˆ—è¡¨
                // å¦‚æœåˆªé™¤çš„æ˜¯ç•¶å‰é¡¯ç¤ºåœ¨è¡¨å–®ä¸­çš„é …ç›®ï¼Œæ¸…ç©ºè¡¨å–®
                if (fullProductInfoInput.value.includes(history.find(item => item.id === id)?.originalProductName || '')) {
                    clearFormAndOutput();
                }
            }
        }

        // --- æ¸…ç©ºè¡¨å–®å’Œè¼¸å‡ºå€ ---
        function clearFormAndOutput() {
            fullProductInfoInput.value = '';

            optimizedProductNameOutput.textContent = '';
            igReelContentOutput.textContent = '';
            threadsContentOutput.textContent = '';
            officialWebsiteContentOutput.textContent = '';
            igPovContentOutput.textContent = '';
            suggestedPriceOutput.textContent = '';
        }

        // --- è§£æå–®ä¸€è¼¸å…¥æ¬„ä½çš„è³‡è¨Š ---
        function parseProductInfo(fullText) {
            const lines = fullText.split('\n').map(line => line.trim()).filter(line => line !== '');
            let originalName = '';
            let productUrl = '';
            let styles = '';
            let sizes = '';
            let internalNotes = '';
            let cost = 0;
            let shipping = 0;
            let collectionFee = 0;

            // å˜—è©¦å¾ç¬¬ä¸€è¡Œç²å–åŸå§‹å“åï¼Œé™¤éå®ƒçœ‹èµ·ä¾†åƒURLæˆ–æˆæœ¬
            if (lines.length > 0 && !lines[0].match(/https?:\/\/\S+/i) && !lines[0].match(/æˆæœ¬\d+\/é‹\d+\/é›†\d+/)) {
                originalName = lines[0];
            } else if (lines.length > 1 && !lines[1].match(/https?:\/\/\S+/i) && !lines[1].match(/æˆæœ¬\d+\/é‹\d+\/é›†\d+/)) {
                // å¦‚æœç¬¬ä¸€è¡Œæ˜¯URLæˆ–æˆæœ¬ï¼Œå˜—è©¦ç¬¬äºŒè¡Œ
                originalName = lines[0]; // é‚„æ˜¯å–ç¬¬ä¸€è¡Œä½œç‚ºå“å
            }


            fullText.split('\n').forEach(line => {
                line = line.trim();
                // é€£çµ
                const urlMatch = line.match(/(https?:\/\/\S+)/i);
                if (urlMatch) {
                    productUrl = urlMatch[1];
                }
                // æ¬¾å¼/é¡è‰²
                const stylesMatch = line.match(/(é¡è‰²|æ¬¾å¼)[:ï¼š]?\s*([^ \n]+(?:[ã€,ï¼Œ\/][^ \n]+)*)/);
                if (stylesMatch) {
                    styles = stylesMatch[2];
                }
                // å°ºå¯¸
                const sizesMatch = line.match(/(å°ºå¯¸)[:ï¼š]?\s*([^\n]+)/);
                if (sizesMatch) {
                    sizes = sizesMatch[2];
                }
                // å…§æ–‡å‚™è¨» (åŒ…å« "ä¸€çµ„2å…¥" ç­‰)
                const notesMatch = line.match(/(å…§æ–‡å‚™è¨»|å‚™è¨»|ä¸€çµ„)[:ï¼š]?\s*([^\n]+)/);
                if (notesMatch) {
                    internalNotes = notesMatch[2];
                }
                // æˆæœ¬
                const costMatch = line.match(/æˆæœ¬(\d+)\/é‹(\d+)\/é›†(\d+)/);
                if (costMatch) {
                    cost = parseFloat(costMatch[1]);
                    shipping = parseFloat(costMatch[2]);
                    collectionFee = parseFloat(costMatch[3]);
                }
            });

            // å¦‚æœåŸå§‹å“åæ²’æœ‰è¢«æ˜ç¢ºè§£æå‡ºä¾†ï¼Œå˜—è©¦å¾ç¬¬ä¸€è¡Œç²å–
            if (!originalName && lines.length > 0) {
                originalName = lines[0].replace(productUrl, '').trim(); // ç§»é™¤URL
            }
            // å¦‚æœåŸå§‹å“åä»ç„¶åŒ…å«å¤ªå¤šè³‡è¨Šï¼Œå˜—è©¦ç°¡åŒ–
            if (originalName.length > 100) { // å‡è¨­éé•·çš„å¯èƒ½æ˜¯å¤šé¤˜è³‡è¨Š
                const firstSentenceMatch = originalName.match(/^[^.!?ã€‚ï¼Ÿï¼\n]+/);
                originalName = firstSentenceMatch ? firstSentenceMatch[0] : originalName.substring(0, 50) + '...';
            }


            return { originalName, productUrl, styles, sizes, internalNotes, cost, shipping, collectionFee };
        }

        // --- ç”Ÿæˆå•†å“è³‡è¨Šèˆ‡å”®åƒ¹ ---
        function generateProductInfo() {
            const fullText = fullProductInfoInput.value;
            if (!fullText.trim()) {
                alert('è«‹åœ¨è¼¸å…¥æ¡†ä¸­è²¼ä¸Šå•†å“è³‡è¨Šï¼');
                return;
            }

            const { originalName, productUrl, styles, sizes, internalNotes, cost, shipping, collectionFee } = parseProductInfo(fullText);

            if (!originalName || cost === 0) {
                alert('ç„¡æ³•å¾æä¾›çš„è³‡è¨Šä¸­è§£æå‡ºæœ‰æ•ˆçš„å•†å“å“åæˆ–æˆæœ¬ï¼Œè«‹æª¢æŸ¥æ ¼å¼ï¼');
                return;
            }

            // 1. å„ªåŒ–å“å (ç°¡é«”è½‰ç¹é«”ä¸¦ç°¡çŸ­)
            let optimizedName = convertToTraditional(originalName);
            // ç§»é™¤å¸¸è¦‹çš„å†—é¤˜è©å½™ï¼Œä¸¦ç°¡åŒ–
            optimizedName = optimizedName
                .replace(/è·¨å¢ƒ|æ±½è»Š|é‡‘å±¬|ä¸€éµå•Ÿå‹•|æ–æ¡¿çƒ|è»Šè¼‰|è£é£¾è²¼|æŒ‰éˆ•éµ|ä¿è­·è“‹/g, (match) => {
                    switch(match) {
                        case 'æ±½è»Š': return ''; // ç§»é™¤
                        case 'é‡‘å±¬': return ''; // ç§»é™¤
                        case 'è£é£¾è²¼': return ''; // ç§»é™¤
                        case 'æŒ‰éˆ•éµ': return ''; // ç§»é™¤
                        case 'ä¿è­·è“‹': return 'ä¿è­·è“‹'; // ä¿ç•™
                        case 'ä¸€éµå•Ÿå‹•': return 'ä¸€éµå•Ÿå‹•'; // ä¿ç•™
                        case 'æ–æ¡¿çƒ': return 'æ–æ¡¿çƒ'; // ä¿ç•™
                        default: return match;
                    }
                })
                .replace(/é€£é«”ç¡è¡£/g, 'é€£é«”ç¡è¡£') // ç¢ºä¿è½‰æ›å¾Œç°¡çŸ­
                .replace(/å¯¶å¯å¤¢\s*é€£é«”ç¡è¡£/g, 'å¯¶å¯å¤¢é€£é«”ç¡è¡£') // é¿å…é‡è¤‡
                .replace(/ä¸€éµå•Ÿå‹•æ–æ¡¿çƒä¿è­·è“‹/g, 'ä¸€éµå•Ÿå‹•æ–æ¡¿çƒä¿è­·è“‹') // ç¢ºä¿å®Œæ•´å“å
                .trim();

            // å¦‚æœå„ªåŒ–å¾Œå¤ªçŸ­æˆ–ä¸åŒ…å«é—œéµå­—ï¼Œå‰‡ä½¿ç”¨é è¨­æˆ–æ›´å®Œæ•´çš„åç¨±
            if (optimizedName.length < 5 || (!optimizedName.includes('ä¿è­·è“‹') && !optimizedName.includes('ç¡è¡£') && !optimizedName.includes('é€£é«”è¡£'))) {
                 if (originalName.includes('å®å¯æ¢¦') || originalName.includes('Pokemon') || originalName.includes('å¯¶å¯å¤¢')) {
                    optimizedName = 'å¯¶å¯å¤¢ç³»åˆ—é€£é«”ç¡è¡£';
                } else if (originalName.includes('æ±½è½¦') || originalName.includes('æ±½è»Š') || originalName.includes('ä¸€é”®å¯åŠ¨') || originalName.includes('ä¸€éµå•Ÿå‹•')) {
                    optimizedName = 'æ±½è»Šä¸€éµå•Ÿå‹•æ–æ¡¿çƒä¿è­·è“‹';
                } else {
                    optimizedName = convertToTraditional(originalName).split(' ')[0] + '...'; // å–ç¬¬ä¸€å€‹è©
                }
            }
            optimizedProductNameOutput.textContent = optimizedName;

            // 2. ç”Ÿæˆæ–‡æ¡ˆ
            const stylesArr = styles.split(/[ã€,ï¼Œ\/]/).map(s => s.trim()).filter(s => s !== '');
            const stylesText = stylesArr.length > 0 ? stylesArr.join('ã€') : 'å¤šç¨®æ¬¾å¼/é¡è‰²';
            const hasPokemon = originalName.includes('å®å¯æ¢¦') || originalName.includes('Pokemon') || originalName.includes('å¯¶å¯å¤¢') || optimizedName.includes('å¯¶å¯å¤¢');
            const hasCar = originalName.includes('æ±½è»Š') || originalName.includes('ä¸€éµå•Ÿå‹•') || optimizedName.includes('æ±½è»Š');

            let igReel = '';
            let threads = '';
            let officialWebsite = '';
            let igPov = '';

            if (hasPokemon) {
                igReel = `
ç©¿ä¸Šç‰ å€‘ï¼Œä¸€èµ·é€²å…¥å¯¶å¯å¤¢ä¸–ç•Œå§âš¡ï¸ï¼

#${optimizedName}

æƒ³è·Ÿå¯¶å¯å¤¢ä¸€èµ·å®…å®¶è€å»¢ï¼Ÿé€™æ¬¾é€£é«”ç¡è¡£çœŸçš„å¤ªå¯ä»¥ï¼
${stylesText.includes('å‘†ç«é±·') ? 'å‘†ç«é±·è¶…å¯æ„›ã€' : ''}${stylesText.includes('ç”²è³€å¿è›™') ? 'ç”²è³€å¿è›™è¶…å¸¥ï¼Œ' : ''}é‚„æœ‰${stylesText}ç­‰ç¶“å…¸è§’è‰²ğŸ’¥
é€£å¸½é€ å‹ï¼‹é¬†è»Ÿæè³ªï¼Œç¡è¦ºã€è¿½åŠ‡ã€æ‰“é›»å‹•éƒ½èˆ’æœåˆ°ä¸æƒ³è„«ï½

å°ºå¯¸ï¼š${sizes || 'Sï½XL'}ï¼Œæƒ…ä¾¶é–¨èœœä¹Ÿèƒ½ä¸€èµ·ç©¿ï¼${internalNotes ? `\nå‚™è¨»ï¼š${internalNotes}` : ''}

ç•™è¨€ã€Œå¯¶å¯å¤¢ã€æˆ‘å‚³çµ¦ä½ ğŸ§¡
âš ï¸å…ˆè¿½è¹¤å†ç•™è¨€ï¼Œæ‰æ”¶å¾—åˆ°å–”ï¼

å°ç£å‡ºè²¨ğŸššå°ç£å®˜ç¶²ä¸‹å–®ï¼Œå¤šç¨®ä»˜æ¬¾æ–¹å¼
å…¨çƒé…é€ğŸŒæµ·å¤–ä¸‹å–®ï¼Œæˆªåœ–å•†å“ï¼Œç§è¨Šä¸‹å–®
                `.trim();

                threads = `
è®Šèº«æœ€å¯æ„›çš„ç‰ ï¼âœ¨
${stylesText}ç­‰è§’è‰²ä»»ä½ é¸ğŸ’•
                `.trim();

                officialWebsite = `
**${optimizedName}**
å°ºå¯¸ï¼š${sizes || 'Sï½XL'}ï¼Œæƒ…ä¾¶é–¨èœœä¹Ÿèƒ½ä¸€èµ·ç©¿

æƒ³è·Ÿå¯¶å¯å¤¢ä¸€èµ·å®…å®¶è€å»¢ï¼Ÿ
é€™æ¬¾é€£é«”ç¡è¡£çœŸçš„å¤ªå¯ä»¥ï¼
${stylesText.includes('å‘†ç«é±·') ? 'å‘†ç«é±·è¶…å¯æ„›ã€' : ''}${stylesText.includes('ç”²è³€å¿è›™') ? 'ç”²è³€å¿è›™è¶…å¸¥ï¼Œ' : ''}é‚„æœ‰${stylesText}ç­‰ç¶“å…¸è§’è‰²ğŸ’¥
é€£å¸½é€ å‹ï¼‹é¬†è»Ÿæè³ªï¼Œç¡è¦ºã€è¿½åŠ‡ã€æ‰“é›»å‹•éƒ½èˆ’æœåˆ°ä¸æƒ³è„«ï½
                `.trim();

                const randomPokemonStyle = stylesArr[Math.floor(Math.random() * stylesArr.length)] || 'å¯¶å¯å¤¢';
                igPov = `
POV.åˆ¥åµæˆ‘ï¼Œæˆ‘ä»Šå¤©æ˜¯${randomPokemonStyle}ä¸æ˜¯ä¸Šç­æ—ğŸ¸ğŸŒ€
                `.trim();

            } else if (hasCar) {
                igReel = `
ä¸€éµå•Ÿå‹•ä½ çš„é¢¨æ ¼ï¼âœ¨

#${optimizedName}

æƒ³è®“æ„›è»Šå…§è£æ›´å¸ç›ï¼Ÿé€™æ¬¾é‡‘å±¬æ–æ¡¿çƒä¿è­·è“‹çµ•å°æ˜¯ä½ çš„èœï¼
${stylesText}å¯é¸ï¼Œè¼•é¬†é»ç¶´ï¼Œè®“ä½ çš„è»Šå…§ç©ºé–“ç¬é–“å‡ç´šğŸ’¥
å®‰è£ç°¡å–®ï¼Œæ‰‹æ„Ÿèˆ’é©ï¼Œä¸åƒ…ä¿è­·æŒ‰éˆ•ï¼Œæ›´æ˜¯å€‹æ€§å±•ç¾ï¼

${internalNotes ? `${internalNotes}ï¼Œ` : ''}æƒ…ä¾¶è»Šã€å§å¦¹è»Šéƒ½èƒ½ä¸€èµ·ç”¨ï¼

ç•™è¨€ã€Œæ–æ¡¿çƒã€æˆ‘å‚³çµ¦ä½ ğŸ§¡
âš ï¸å…ˆè¿½è¹¤å†ç•™è¨€ï¼Œæ‰æ”¶å¾—åˆ°å–”ï¼

å°ç£å‡ºè²¨ğŸššå°ç£å®˜ç¶²ä¸‹å–®ï¼Œå¤šç¨®ä»˜æ¬¾æ–¹å¼
å…¨çƒé…é€ğŸŒæµ·å¤–ä¸‹å–®ï¼Œæˆªåœ–å•†å“ï¼Œç§è¨Šä¸‹å–®
                `.trim();

                threads = `
è»Šå…§è³ªæ„Ÿç§’å‡ç´šï¼âœ¨
${stylesText}ï¼Œä¸€éµå•Ÿå‹•ä½ çš„å°ˆå±¬é¢¨æ ¼ğŸ’•
                `.trim();

                officialWebsite = `
**${optimizedName}**
${internalNotes}

æƒ³è®“æ„›è»Šå…§è£æ›´å¸ç›ï¼Ÿ
é€™æ¬¾é‡‘å±¬æ–æ¡¿çƒä¿è­·è“‹çµ•å°æ˜¯ä½ çš„èœï¼
${stylesText}å¯é¸ï¼Œè¼•é¬†é»ç¶´ï¼Œè®“ä½ çš„è»Šå…§ç©ºé–“ç¬é–“å‡ç´šğŸ’¥
å®‰è£ç°¡å–®ï¼Œæ‰‹æ„Ÿèˆ’é©ï¼Œä¸åƒ…ä¿è­·æŒ‰éˆ•ï¼Œæ›´æ˜¯å€‹æ€§å±•ç¾ï¼
                `.trim();

                const randomCarStyle = stylesArr[Math.floor(Math.random() * stylesArr.length)] || 'ç´…';
                igPov = `
POV.åˆ¥åµæˆ‘ï¼Œæˆ‘çš„è»Šä»Šå¤©å¾ˆ${randomCarStyle.replace('è‰²', '')}ä¸æ˜¯åªæœ‰ä½ ğŸ˜${randomCarStyle === 'ç´…' ? 'ğŸ”´' : randomCarStyle === 'é»‘' ? 'âš«' : randomCarStyle === 'è—' ? 'ğŸ”µ' : 'âœ¨'}
                `.trim();
            } else {
                // æ³›ç”¨å‹æ–‡æ¡ˆ
                igReel = `
å…¨æ–°å•†å“ç™»å ´ï¼âœ¨

#${optimizedName}

é€™æ¬¾å•†å“è¨­è¨ˆç¨ç‰¹ï¼ŒåŠŸèƒ½å¯¦ç”¨ï¼Œçµ•å°æ˜¯æ‚¨ä¸å¯éŒ¯éçš„é¸æ“‡ï¼
${stylesText}å¤šç¨®é¸æ“‡ï¼Œæ»¿è¶³æ‚¨çš„ä¸åŒéœ€æ±‚ğŸ’¥
é«˜å“è³ªææ–™ï¼Œç²¾ç·»å·¥è—ï¼Œè®“æ‚¨çš„ç”Ÿæ´»æ›´ç¾å¥½ï½

å°ºå¯¸ï¼š${sizes || 'å¤šç¨®å°ºå¯¸'} ${internalNotes ? `\nå‚™è¨»ï¼š${internalNotes}` : ''}

ç«‹å³é»æ“Šé€£çµäº†è§£æ›´å¤šï¼ğŸ”—

å°ç£å‡ºè²¨ğŸššå°ç£å®˜ç¶²ä¸‹å–®ï¼Œå¤šç¨®ä»˜æ¬¾æ–¹å¼
å…¨çƒé…é€ğŸŒæµ·å¤–ä¸‹å–®ï¼Œæˆªåœ–å•†å“ï¼Œç§è¨Šä¸‹å–®
                `.trim();

                threads = `
è¶…å¯¦ç”¨æ–°å“ï¼âœ¨
${stylesText}ï¼Œè®“ç”Ÿæ´»æ›´ä¾¿åˆ©ğŸ’•
                `.trim();

                officialWebsite = `
**${optimizedName}**
å°ºå¯¸ï¼š${sizes || 'å¤šç¨®å°ºå¯¸'} ${internalNotes}

é€™æ¬¾å•†å“è¨­è¨ˆç¨ç‰¹ï¼ŒåŠŸèƒ½å¯¦ç”¨ï¼Œçµ•å°æ˜¯æ‚¨ä¸å¯éŒ¯éçš„é¸æ“‡ï¼
${stylesText}å¤šç¨®é¸æ“‡ï¼Œæ»¿è¶³æ‚¨çš„ä¸åŒéœ€æ±‚ğŸ’¥
é«˜å“è³ªææ–™ï¼Œç²¾ç·»å·¥è—ï¼Œè®“æ‚¨çš„ç”Ÿæ´»æ›´ç¾å¥½ï½
                `.trim();

                igPov = `
POV.ç•¶æˆ‘æ“æœ‰${optimizedName}ï¼Œç”Ÿæ´»å“è³ªç›´æ¥æå‡ä¸€å€‹æª”æ¬¡ï¼âœ¨
                `.trim();
            }

            igReelContentOutput.textContent = igReel;
            threadsContentOutput.textContent = threads;
            officialWebsiteContentOutput.textContent = officialWebsite;
            igPovContentOutput.textContent = igPov;


            // 3. è¨ˆç®—å”®åƒ¹
            const initialCost = cost + shipping + collectionFee;
            const websiteFeeRate = 0.05; // å®˜ç¶²æŠ½æˆ 5%
            const creditCardFeeRate = 0.045; // ä¿¡ç”¨å¡è²»ç‡ 4.5%
            const totalFeeRate = websiteFeeRate + creditCardFeeRate; // ç¸½æ‰‹çºŒè²»ç‡ 9.5%
            const targetProfitMargin = 0.60; // ç›®æ¨™åˆ©æ½¤ 60%

            // è¨ˆç®—å…¬å¼ï¼šå”®åƒ¹ S = åˆå§‹æˆæœ¬ / (1 - ç¸½æ‰‹çºŒè²»ç‡ - ç›®æ¨™åˆ©æ½¤ç‡)
            let suggestedPrice = initialCost / (1 - totalFeeRate - targetProfitMargin);

            // ç¢ºä¿åƒ¹æ ¼ç‚ºæ•´æ•¸ï¼Œä¸¦å‘ä¸Šå–æ•´
            suggestedPrice = Math.ceil(suggestedPrice);
            suggestedPriceOutput.textContent = `$${suggestedPrice}`;

            // --- å°‡æœ¬æ¬¡ç”Ÿæˆçš„è³‡æ–™åŠ å…¥æ­·å²ç´€éŒ„ ---
            const newProductEntry = {
                id: Date.now(), // ä½¿ç”¨æ™‚é–“æˆ³ä½œç‚ºå”¯ä¸€ID
                timestamp: new Date().toLocaleString('zh-TW', { hour12: false }), // è¨˜éŒ„ç”Ÿæˆæ™‚é–“
                originalProductName: originalName,
                styles: styles, // å„²å­˜åŸå§‹è§£æçš„ styles å­—ä¸²
                sizes: sizes,
                internalNotes: internalNotes,
                cost: cost,
                shipping: shipping,
                collectionFee: collectionFee,
                productUrl: productUrl,
                optimizedProductName: optimizedName,
                igReelContent: igReel,
                threadsContent: threads,
                officialWebsiteContent: officialWebsite,
                igPovContent: igPov,
                suggestedPrice: suggestedPrice
            };

            const history = loadProductHistory();
            history.push(newProductEntry);
            saveProductHistory(history);
            displayProductHistory(searchHistoryInput.value); // æ›´æ–°æ­·å²åˆ—è¡¨
        }

        // --- åŒ¯å‡ºç‚º CSV (Excel) ---
        function exportToCsv() {
            const history = loadProductHistory();
            if (history.length === 0) {
                alert('æ²’æœ‰æ­·å²ç´€éŒ„å¯ä»¥åŒ¯å‡ºï¼');
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // æ·»åŠ  BOM ä»¥ç¢ºä¿ä¸­æ–‡é¡¯ç¤ºæ­£å¸¸

            // CSV è¡¨é ­
            const headers = [
                'ID', 'ç”Ÿæˆæ™‚é–“', 'åŸå§‹å“å', 'å„ªåŒ–å¾Œå“å', 'æ¬¾å¼', 'å°ºå¯¸', 'å…§æ–‡å‚™è¨»',
                'æˆæœ¬', 'é‹è²»', 'é›†é‹è²»', 'å•†å“é€£çµ', 'å»ºè­°å”®åƒ¹',
                'IG Reel æ–‡æ¡ˆ', 'Threads æ–‡æ¡ˆ', 'å®˜ç¶²æ–‡æ¡ˆ', 'IG POV æ–‡æ¡ˆ'
            ];
            csvContent += headers.map(h => `"${h}"`).join(',') + '\n';

            // CSV å…§å®¹
            history.forEach(item => {
                const row = [
                    item.id,
                    item.timestamp,
                    item.originalProductName,
                    item.optimizedProductName,
                    item.styles, // ä½¿ç”¨å„²å­˜çš„ styles å­—ä¸²
                    item.sizes,
                    item.internalNotes,
                    item.cost,
                    item.shipping,
                    item.collectionFee,
                    item.productUrl,
                    item.suggestedPrice,
                    `"${item.igReelContent.replace(/"/g, '""')}"`, // è™•ç†å¼•è™Ÿ
                    `"${item.threadsContent.replace(/"/g, '""')}"`,
                    `"${item.officialWebsiteContent.replace(/"/g, '""')}"`,
                    `"${item.igPovContent.replace(/"/g, '""')}"`
                ];
                csvContent += row.map(field => {
                    // å°æ–¼åŒ…å«é€—è™Ÿã€å¼•è™Ÿæˆ–æ›è¡Œçš„å­—ä¸²é€²è¡Œè™•ç†
                    if (typeof field === 'string' && (field.includes(',') || field.includes('"') || field.includes('\n'))) {
                        return `"${field.replace(/"/g, '""')}"`;
                    }
                    return field;
                }).join(',') + '\n';
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'å•†å“ç”Ÿæˆæ­·å²ç´€éŒ„.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥è³‡æ–™ä¸¦é¡¯ç¤ºæ­·å²ç´€éŒ„ ---
        window.onload = () => {
            const history = loadProductHistory();
            if (history.length > 0) {
                // è¼‰å…¥æœ€æ–°ä¸€ç­†è³‡æ–™åˆ°è¼¸å…¥æ¡†å’Œè¼¸å‡ºå€
                const latestProduct = history[history.length - 1];
                loadProductToForm(latestProduct.id);
            } else {
                // å¦‚æœæ²’æœ‰æ­·å²ç´€éŒ„ï¼Œå‰‡å¡«å…¥ä½ æä¾›çš„æ±½è»Šå•†å“ç¯„ä¾‹
                fullProductInfoInput.value = `è·¨å¢ƒæ±½è½¦é‡‘å±ä¸€é”®å¯åŠ¨æ‘‡æ†çƒè½¦è½½ä¸€é”®å¯åŠ¨è£…é¥°è´´æ±½è½¦æŒ‰é’®é”®ä¿æŠ¤ç›–
https://detail.1688.com/offer/947903075253.html?offerId=947903075253
é¡è‰²ï¼šç´…ã€é»‘ã€è—
ä¸€çµ„2å…¥
æˆæœ¬10/é‹15/é›†30`;
                generateProductInfo(); // è‡ªå‹•ç”Ÿæˆä¸€æ¬¡ï¼Œä»¥ä¾¿åœ¨åˆæ¬¡è¼‰å…¥æ™‚é¡¯ç¤ºå…§å®¹
            }
            displayProductHistory(); // é¡¯ç¤ºæ‰€æœ‰æ­·å²ç´€éŒ„
        };

        // --- æœå°‹åŠŸèƒ½ç›£è½ ---
        searchHistoryInput.addEventListener('input', (event) => {
            displayProductHistory(event.target.value);
        });
    </script>
</body>
</html>
